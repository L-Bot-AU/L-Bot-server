{% macro today(libname) -%}
	<script src="https://www.chartjs.org/dist/2.9.4/Chart.min.js"></script>
	<style>
		.selected {
		    text-underline-offset: 8px;
			text-decoration: underline;
		}
	</style>
	<canvas id="{{ libname }}Trends"></canvas>
{%- endmacro %}

{% macro scripts() %}
	<script>
		function genAlert(libname, data) {
			if (data["alert"] !== "") {
				// nonzero alert
				document.getElementById(libname + "Alert").style.display = "visible";
				document.getElementById(libname + "Alerttext").innerHTML = data["alert"];
			}
			else {
				document.getElementById(libname + "Alert").style.display = "none";
			}
		}
		
		function genRemaining(libname, data) {
			document.getElementById(libname + "Remaining").innerHTML = data["max"] - data["count"];
		}

		function genFullness(libname, data) {
			let percentageFull = Math.round(data["count"] / data["max"] * 100);
			
			if (percentageFull <= 30) {
				document.getElementById(libname + "Status").innerHTML = "Not busy";
			}
			else if (percentageFull <= 70) {
				document.getElementById(libname + "Status").innerHTML = "Busy";
			}
			else {
				document.getElementById(libname + "Status").innerHTML = "Very busy";
			}
			
			document.getElementById(libname + "Fullness").innerHTML = percentageFull + "% full";
			document.getElementById(libname + "Fullness").style.width = percentageFull + "%";
		}
		
		function genToday(libname, data) {
			var day = new Date().getDay() - 1;
			console.log(data["trends"]["data"][day]);
			var ctx = document.getElementById(libname + "Trends").getContext("2d");
			window.todayGraph[libname] = new Chart(ctx, {
				type: "bar",
				label: "mon",
				data: {
					labels: data["trends"]["labels"],
					datasets: {
						data: data["trends"]["data"][day],
						pointHitRadius: 5,
						HoverBackgroundColor: [
							"rgba(255, 99, 132, 1)",
							"rgba(54, 162, 235, 1)",
							"rgba(85, 214, 64, 1)",
							"rgba(75, 192, 192, 1)",
							"rgba(153, 102, 255, 1)",
							"rgba(255, 159, 64, 1)"
						][day],
						backgroundColor: [
							"rgba(255, 99, 132, 0.2)",
							"rgba(54, 162, 235, 0.2)",
							"rgba(85, 214, 64, 0.2)",
							"rgba(75, 192, 192, 0.2)",
							"rgba(153, 102, 255, 0.2)",
							"rgba(255, 159, 64, 0.2)"
						][day],
						borderColor: [
							"rgba(255, 99, 132, 1)",
							"rgba(54, 162, 235, 1)",
							"rgba(85, 214, 64, 1)",
							"rgba(75, 192, 192, 1)",
							"rgba(153, 102, 255, 1)",
							"rgba(255, 159, 64, 1)"
						][day],
						borderWidth: 3
					},
				},
				options: {
					legend: {
						display: false,
					},
					scales: {
						yAxes: [{
							ticks: {
								beginAtZero: true,
								max: 100,
							}
						}]
					}
				}
			});
		}
		
		window.todayGraph = {};
		getReq("home", function (data) {
			console.log(data);
			["jnr", "snr"].forEach(function(libname) {
				genAlert(libname, data[libname]);
				genRemaining(libname, data[libname]);
				genFullness(libname, data[libname]);
				genToday(libname, data[libname]);
			})
		});
		
	</script>
{% endmacro %}