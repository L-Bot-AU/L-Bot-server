{% macro today(lib) -%}
	<table id="{{ lib }}today">
		<tr>
			<td class="period"> Period 1 </td>
			<td> 5 </td>
		</tr>
		<tr>
			<td class="period"> 12 Maths Ma1 </td>
			<td> 4 </td>
		</tr>
		<tr>
			<td class="period"> Recess </td>
			<td> 46 </td>
		</tr>
		<tr>
			<td class="period"> 12 Maths MX1 </td>
			<td> 12 </td>
		</tr>
		<tr>
			<td class="period"> Lunch </td>
			<td> 56 </td>
		</tr>
		<tr>
			<td class="period"> 12 Soft Des </td>
			<td> 14 </td>
		</tr>
		<tr>
			<td class="period"> Period 5 </td>
			<td > 1 </td>
		</tr>
	</table>
{%- endmacro %}

{% macro pasttrends(lib) -%}
	<script src="https://www.chartjs.org/dist/2.9.4/Chart.min.js"></script>
	<style>
	
		#{{ lib }}today {
			width: 25%;
			margin: auto;
		}
		
		tr {
			font-weight: normal;
			font-size: 19px;
		}
		
		.period {
			padding-left: 10px;
			text-align: left;
		}
		
		.selected {
		    text-underline-offset: 8px;
			text-decoration: underline;
		}
	</style>
	{% for i, day in [(0, "Mon"), (1, "Tue"), (2, "Wed"), (3, "Thu"), (4, "Fri")] %}
		<button class="focusbtn {{ lib }}daybtn" onclick="displayGraph(`{{ lib }}`, {{ i }})">{{ day }}</button>
	{% endfor %}
	<br><canvas id="{{ lib }}Predictions"></canvas>
{%- endmacro %}

{% macro scripts() %}
	<script>
		window.hovercolour = [
							"rgba(255, 99, 132, 1)",
							"rgba(54, 162, 235, 1)",
							"rgba(85, 214, 64, 1)",
							"rgba(75, 192, 192, 1)",
							"rgba(153, 102, 255, 1)",
							"rgba(255, 159, 64, 1)"
		]
		window.bgcolour = [
							"rgba(255, 99, 132, 0.2)",
							"rgba(54, 162, 235, 0.2)",
							"rgba(85, 214, 64, 0.2)",
							"rgba(75, 192, 192, 0.2)",
							"rgba(153, 102, 255, 0.2)",
							"rgba(255, 159, 64, 0.2)"
		]
		window.bordercolour = [
							"rgba(255, 99, 132, 1)",
							"rgba(54, 162, 235, 1)",
							"rgba(85, 214, 64, 1)",
							"rgba(75, 192, 192, 1)",
							"rgba(153, 102, 255, 1)",
							"rgba(255, 159, 64, 1)"
		]
		function displayGraph(lib, update){
			for (let i = 0; i < 5; i++) {
				var curr = document.getElementsByClassName(lib + "daybtn")[i];
				if (i === update) curr.classList.add("selected");
				else curr.classList.remove("selected");
			}
			window.predGraph[lib].data.datasets.forEach((dataset) => {
				dataset.data = trendsData[lib]["data"][update];
				dataset.HoverBackgroundColor = window.hovercolour[update];
				dataset.backgroundColor = window.bgcolour[update];
				dataset.borderColor = window.bordercolour[update];
			});
			window.predGraph[lib].update();
		}
		window.predGraph = {};
		window.trendsData = {"snr": {}, "jnr": {}};
		["jnr", "snr"].forEach(function(lib) {
			var day = new Date().getDay() - 1;
			var ctx = document.getElementById(lib + "Predictions").getContext("2d");
			window.predGraph[lib] = new Chart(ctx, {
				type: "bar",
				data: {
					labels: [],
					datasets: [{
						data: [],
						pointHitRadius: 5,
						HoverBackgroundColor: window.hovercolour[day],
						backgroundColor: window.bgcolour[day],
						borderColor: window.bordercolour[day],
						borderWidth: 3
					}],
				},
				options: {
					legend: {
						display: false,
					},
					scales: {
						yAxes: [{
							ticks: {
								beginAtZero: true,
								max: 100,
							}
						}]
					}
				}
			});
			sio.on(lib + "Alert", data => {
				//console.log(data);
				if (data !== "") {
					// nonzero alert
					document.getElementById(lib + "Alert").style.display = "visible";
					document.getElementById(lib + "Alerttext").innerHTML = data;
				}
				else {
					document.getElementById(lib + "Alert").style.display = "none";
				}
			});
			
			
			sio.on(lib + "Remaining", data => {
				//console.log(data);
				document.getElementById(lib + "Remaining").innerHTML = data;
			});
			
			sio.on(lib + "Fullness", data => {
				//console.log(data);
				if (data <= 30) {
					document.getElementById(lib + "Status").innerHTML = "Not busy:";
				}
				else if (data <= 70) {
					document.getElementById(lib + "Status").innerHTML = "Busy:";
				}
				else {
					document.getElementById(lib + "Status").innerHTML = "Very busy:";
				}
				
				document.getElementById(lib + "Fullness").innerHTML = data + "% full";
				document.getElementById(lib + "Fullness").style.width = data + "%";
			});
			
			sio.on(lib + "Trends", data => {
				var day = new Date().getDay() - 1;
				var table = document.getElementById(lib + "today")
				console.log(table);
				//console.log(data);

				window.predGraph[lib].data.labels = data["labels"];
				window.predGraph[lib].update();

				window.trendsData[lib] = data;
			});
		});
		
	</script>
{% endmacro %}